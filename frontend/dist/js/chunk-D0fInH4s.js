var t=Object.defineProperty,e=(e,a,s)=>((e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s)(e,"symbol"!=typeof a?a+"":a,s);import{a}from"./chunk-Do_a5Wyq.js";import{a0 as s,a1 as r}from"./chunk-DyV-rrO-.js";const c=a.create({baseURL:"",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});c.interceptors.request.use(t=>{const e=localStorage.getItem("auth_token")||localStorage.getItem("jwt");return t.headers&&(t.headers["X-Requested-With"]="XMLHttpRequest",t.headers["Cache-Control"]="no-cache"),e&&t.headers&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t)),c.interceptors.response.use(t=>{var e;if(t.status>=200&&t.status<300&&"GET"===(null==(e=t.config.method)?void 0:e.toUpperCase())){const e=t.config.url;e&&(e.includes("/orders/")||e.includes("/products/")||e.includes("/categories/"))&&(t.headers["cache-control"]="public, max-age=300")}return t},t=>{var e,a,s,r,c,n,i,o,d,u,l,p,h;if(401===(null==(e=t.response)?void 0:e.status)){!["/api/products","/api/brands","/api/categories","/api/reviews","/api/vouchers","/api/shipping","/api/payments/vnpay","/api/orders/health","/api/orders/number","/api/chatbot","/api/ai","/api/recommendations"].some(e=>{var a,s;return null==(s=null==(a=t.config)?void 0:a.url)?void 0:s.includes(e)})&&((null==(r=null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.message)?void 0:r.includes("token expired"))||(null==(i=null==(n=null==(c=t.response)?void 0:c.data)?void 0:n.message)?void 0:i.includes("invalid token"))||(null==(u=null==(d=null==(o=t.response)?void 0:o.data)?void 0:d.message)?void 0:u.includes("Unauthorized"))||(null==(h=null==(p=null==(l=t.response)?void 0:l.data)?void 0:p.error)?void 0:h.includes("Unauthorized")))&&(localStorage.removeItem("auth_token"),localStorage.removeItem("jwt"),localStorage.removeItem("auth_user"),"/login"!==window.location.pathname&&"/signup"!==window.location.pathname&&(window.location.href="/login"))}return Promise.reject(t)});const n=new class{constructor(){e(this,"debouncedSearch",null)}async healthCheck(){try{return(await a.get("/actuator/health")).data}catch(t){throw t}}async getProducts(t=0,e=12,a,s){try{const r=new URLSearchParams({page:t.toString(),size:e.toString(),sort:"id,asc"});a&&r.append("search",a),s&&r.append("category",s);return{data:(await c.get(`/api/products?${r}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(r){throw r}}async getSaleProducts(t=12){try{return{data:(await c.get(`/api/products/on-sale?limit=${t}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){throw e}}async getProduct(t){try{return{data:(await c.get(`/api/products/${t}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){throw e}}async getProductVariants(t){try{return{data:(await c.get(`/api/products/${t}/variants`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){throw e}}async getDefaultVariant(t){try{return{data:(await c.get(`/api/products/${t}/variants/default`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){throw e}}async createVariant(t,e){try{return{data:(await c.post(`/api/products/${t}/variants`,e)).data,success:!0}}catch(a){throw a}}async updateVariant(t,e){try{return{data:(await c.put(`/api/products/variants/${t}`,e)).data,success:!0}}catch(a){throw a}}async deleteVariant(t){try{return await c.delete(`/api/products/variants/${t}`),{data:void 0,success:!0}}catch(e){throw e}}async getOrders(t=0,e=10,a){try{const s=JSON.parse(localStorage.getItem("auth_user")||"{}"),r=a||s.id||s.userId||1;return{data:(await c.get(`/api/orders/my-orders?userId=${r}&page=${t}&size=${e}`)).data,success:!0}}catch(s){throw s}}async getOrderByNumber(t){try{return{data:(await c.get(`/api/orders/number/${t}`)).data,success:!0}}catch(e){throw e}}async cancelOrderByNumber(t,e){try{return{data:(await c.post(`/api/orders/by-number/${t}/cancel`,{reason:e},{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(a){return{data:void 0,success:!1,message:"Failed to cancel order"}}}async searchProducts(t,e){return this.debouncedSearch||(this.debouncedSearch=((t,e)=>{let a;return(...s)=>{clearTimeout(a),a=setTimeout(()=>t(...s),e)}})(async(t,e)=>this.getProducts(0,12,t,e),300)),this.debouncedSearch(t,e)}async createOrder(t){try{return{data:(await c.post("/api/orders",t)).data,success:!0,message:"Order created successfully"}}catch(e){throw e}}async cancelOrder(t,e){try{const a=await c.get(`/api/orders/${t}`);if(a.data&&a.data.orderNumber){const t=a.data.orderNumber;return{data:(await c.post(`/api/orders/by-number/${t}/cancel`,{reason:e})).data,success:!0,message:"Order cancelled successfully"}}throw new Error("Order number not found")}catch(a){return{data:void 0,success:!1,message:"Failed to cancel order"}}}async getCart(t){try{const e=t?`?userId=${t}`:"";return{data:(await c.get(`/api/cart${e}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Cart retrieved successfully"}}catch(e){throw e}}async addToCart(t,e,a){try{const s=a?`?userId=${a}`:"";return{data:(await c.post(`/api/cart/add${s}`,{productId:t,quantity:e},{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Product added to cart successfully"}}catch(s){throw s}}async updateCartItem(t,e,a){try{if(!a)throw new Error("Missing userId for updateCartItem");return{data:(await c.put(`/api/cart/${a}/update`,{productId:t,quantity:e},{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Cart item updated successfully"}}catch(s){throw s}}async removeFromCart(t,e){try{if(!e)throw new Error("Missing userId for removeFromCart");return{data:(await c.delete(`/api/cart/${e}/remove/${t}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Product removed from cart successfully"}}catch(a){throw a}}async clearCart(t){try{if(!t)throw new Error("Missing userId for clearCart");return{data:(await c.delete(`/api/cart/${t}/clear`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Cart cleared successfully"}}catch(e){throw e}}async applyPromoCode(t,e){try{const a=e?`?userId=${e}`:"";return{data:(await c.post(`/api/cart/promo${a}`,{promoCode:t},{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Promo code applied successfully"}}catch(a){throw a}}async removePromoCode(t){try{const e=t?`?userId=${t}`:"";return{data:(await c.delete(`/api/cart/promo${e}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Promo code removed successfully"}}catch(e){throw e}}async getCartItemCount(t){try{const e=t?`?userId=${t}`:"";return{data:(await c.get(`/api/cart/count${e}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Cart count retrieved successfully"}}catch(e){throw e}}async mergeGuestCart(t){try{return{data:(await c.post(`/api/cart/merge?userId=${t}`,{},{headers:{"X-Skip-Auth":"true"}})).data,success:!0,message:"Guest cart merged successfully"}}catch(e){throw e}}async getUsers(){try{0;return{data:(await c.get("/api/admin/users")).data,success:!0}}catch(t){throw t}}async updateUserRole(t,e,a){try{0;return{data:(await c.put(`/api/admin/users/${t}/role`,{role:e,reason:a||"Role updated by admin"})).data,success:!0}}catch(s){throw s}}async toggleUserStatus(t,e){try{0;return{data:(await c.put(`/api/admin/users/${t}/status`,{isActive:e})).data,success:!0}}catch(a){throw a}}async createAdminUser(){try{0;return{data:(await c.post("/api/admin/create-admin")).data,success:!0}}catch(t){throw t}}async adminCreateUser(t){return{data:(await c.post("/api/admin/users",t)).data,success:!0}}async adminUpdateUser(t,e){try{0;return{data:(await c.put(`/api/admin/users/${t}`,e)).data,success:!0}}catch(a){throw a}}async adminDeleteUser(t){return{data:(await c.delete(`/api/admin/users/${t}`)).data,success:!0}}async adminGetProducts(t=0,e=10){try{0;return{data:(await c.get(`/api/admin/products?page=${t}&size=${e}`)).data,success:!0}}catch(a){throw a}}async adminCreateProduct(t){return{data:(await c.post("/api/admin/products",t)).data,success:!0}}async adminUpdateProduct(t,e){return{data:(await c.put(`/api/admin/products/${t}`,e)).data,success:!0}}async adminDeleteProduct(t){return{data:(await c.delete(`/api/admin/products/${t}`)).data,success:!0}}async adminRestockProduct(t,e,a){return{data:(await c.post("/api/inventory/restock",{productId:t,quantity:e,warehouseId:a})).data,success:!0}}async adminFixAllProductStock(){return{data:(await c.post("/api/admin/products/fix-stock")).data,success:!0}}async adminGetOrders(t=0,e=10,a){try{const s=new URLSearchParams({page:String(t),size:String(e)});a&&s.set("status",a);return{data:(await c.get(`/api/admin/orders?${s.toString()}`)).data,success:!0}}catch(s){throw s}}async adminUpdateOrderStatus(t,e,a){return{data:(await c.put(`/api/admin/orders/${t}/status`,{status:e,reason:a})).data,success:!0}}async adminUploadImage(t){const e=new FormData;e.append("file",t);return{data:(await c.post("/api/admin/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,success:!0}}async adminGetDashboardStats(){return{data:(await c.get("/api/admin/dashboard/stats")).data,success:!0}}async adminListProductImages(t){return{data:(await c.get(`/api/admin/products/${t}/images`)).data,success:!0}}async adminUploadProductImages(t,e){const a=new FormData;e.forEach(t=>a.append("files",t));return{data:(await c.post(`/api/admin/products/${t}/images`,a,{headers:{"Content-Type":"multipart/form-data"}})).data,success:!0}}async adminDeleteProductImage(t,e){return{data:(await c.delete(`/api/admin/products/${t}/images/${e}`)).data,success:!0}}async login(t,e){try{0;const r=await c.post("/api/auth/login",{username:t,password:e});0;const n=r.data.token,i=r.data.user||{};try{if(i&&i.userId&&!i.id&&(i.id=i.userId),!(null==i?void 0:i.role)&&n){const t=n.split(".");if(3===t.length){const e=JSON.parse(atob(t[1]));e&&e.role&&(i.role=String(e.role))}}}catch(a){}try{if(!(null==i?void 0:i.role)&&n){const t=n.split(".");if(3===t.length){const e=JSON.parse(atob(t[1]));e&&e.role&&(i.role=String(e.role).toUpperCase())}}else(null==i?void 0:i.role)&&(i.role=String(i.role).toUpperCase())}catch(s){}return{data:{token:n,user:i},message:r.data.message||"Login successful",success:r.data.success||!0}}catch(r){throw r}}async register(t){try{const e=await c.post("/api/auth/register",t);return{data:{user:e.data.user},message:e.data.message||"Registration successful",success:e.data.success||!0}}catch(e){throw e}}async sendPhoneOtp(t){try{const e=await c.post("/api/auth/phone/send-otp",{phone:t});return{data:e.data,message:e.data.message||"OTP sent",success:e.data.success||!0}}catch(e){throw e}}async verifyPhoneOtp(t){try{const e=await c.post("/api/auth/phone/verify-otp",t);return{data:{token:e.data.token,user:e.data.user},message:e.data.message||"Phone verified",success:e.data.success||!0}}catch(e){throw e}}async forgotPassword(t){try{const e=await c.post("/api/auth/forgot-password",{email:t});return{data:e.data,message:e.data.message||"Reset email sent",success:e.data.success||!0}}catch(e){throw e}}async resetPassword(t,e){try{const a=await c.post("/api/auth/reset-password",{token:t,password:e});return{data:a.data,message:a.data.message||"Password reset successful",success:a.data.success||!0}}catch(a){throw a}}async verifyEmail(t){var e,a,s,r,n,i;try{const e=await c.post("/api/auth/verify-email",{token:t});return{data:e.data,message:e.data.message||"Email verified successfully",success:e.data.success||!0}}catch(o){return{data:void 0,success:!1,message:(null==(a=null==(e=null==o?void 0:o.response)?void 0:e.data)?void 0:a.message)||(null==(r=null==(s=null==o?void 0:o.response)?void 0:s.data)?void 0:r.error)||(null==(i=null==(n=null==o?void 0:o.response)?void 0:n.data)?void 0:i.body)||"Verification failed."}}}async changePassword(t,e){try{const a=await c.post("/api/users/change-password",{currentPassword:t,newPassword:e});return{data:a.data,message:a.data.message||"Password changed successfully",success:a.data.success||!0}}catch(a){throw a}}async updatePreferences(t){try{const e=await c.put("/api/users/preferences",t);return{data:e.data,message:e.data.message||"Preferences updated successfully",success:e.data.success||!0}}catch(e){throw e}}async updateNotificationSettings(t){try{const e=await c.put("/api/users/notifications",t);return{data:e.data,message:e.data.message||"Notification settings updated successfully",success:e.data.success||!0}}catch(e){throw e}}async getUserProfile(){try{0;return{data:(await c.get("/api/users/profile")).data,success:!0}}catch(t){throw t}}async updateUserProfile(t){try{const e=await c.put("/api/users/profile",t);return{data:e.data.user||e.data,message:e.data.message||"Profile updated successfully",success:e.data.success||!0}}catch(e){throw e}}async addToFavorites(t,e){try{return{data:(await c.post(`/api/favorites/user/${e}/add`,{productId:t})).data,message:"Added to favorites",success:!0}}catch(a){throw a}}async removeFromFavorites(t,e){try{return{data:(await c.delete(`/api/favorites/user/${e}/remove/${t}`)).data,message:"Removed from favorites",success:!0}}catch(a){throw a}}async getFavorites(t){try{return{data:(await c.get(`/api/favorites/user/${t}`)).data,success:!0}}catch(e){throw e}}async sendChatMessage(t,e){try{return{data:(await c.post("/api/chatbot/message",{message:t,sessionId:e})).data,success:!0}}catch(a){throw a}}async getChatHistory(t){try{return{data:(await c.get(`/api/chatbot/session/${t}`)).data,success:!0}}catch(e){throw e}}async createChatSession(t,e=""){try{return{data:(await c.post("/api/chatbot/session",{userId:t,initialMessage:e})).data,success:!0}}catch(a){throw a}}async logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")}async getInventory(t=0,e=10){try{return{data:(await c.get(`/api/admin/inventory?page=${t}&size=${e}`)).data,success:!0}}catch(a){throw a}}async getCategoriesWithCount(){return(await c.get("/api/categories/with-count",{headers:{"X-Skip-Auth":"true"}})).data}async getProvinces(){var t,e,a,s,r,n;try{return{data:(await c.get("/api/shipping/provinces",{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(i){if(401===(null==(t=i.response)?void 0:t.status)||500===(null==(e=i.response)?void 0:e.status)){const t=(null==(s=null==(a=i.response)?void 0:a.data)?void 0:s.error)||"";if(t.includes("GHN_API_TOKEN")||t.includes("missing"))return{data:[],success:!1,message:"Shipping service temporarily unavailable. Please contact support."}}return{data:[],success:!1,message:(null==(n=null==(r=i.response)?void 0:r.data)?void 0:n.message)||"Failed to load provinces"}}}async getCommunesByProvince(t){var e,a,s,r,n,i;try{return{data:(await c.get(`/api/shipping/provinces/${t}/communes`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(o){if(401===(null==(e=o.response)?void 0:e.status)||500===(null==(a=o.response)?void 0:a.status)){const t=(null==(r=null==(s=o.response)?void 0:s.data)?void 0:r.error)||"";if(t.includes("GHN_API_TOKEN")||t.includes("missing")||t.includes("not configured"))return{data:[],success:!1,message:"Shipping service temporarily unavailable. Please contact support."}}return{data:[],success:!1,message:(null==(i=null==(n=o.response)?void 0:n.data)?void 0:i.message)||"Failed to load communes"}}}async getDistrictsByProvince(t){var e,a,s,r;try{return(await c.get(`/api/shipping/districts/getByProvince?provinceCode=${t}`,{headers:{"X-Skip-Auth":"true"}})).data}catch(n){if(401===(null==(e=n.response)?void 0:e.status)||500===(null==(a=n.response)?void 0:a.status)){const t=(null==(r=null==(s=n.response)?void 0:s.data)?void 0:r.error)||"";t.includes("GHN_API_TOKEN")||t.includes("missing")||t.includes("not configured")}return[]}}async getWardsByDistrict(t){var e,a,s,r;try{return(await c.get(`/api/shipping/wards/getByDistrict?districtCode=${t}`,{headers:{"X-Skip-Auth":"true"}})).data}catch(n){if(401===(null==(e=n.response)?void 0:e.status)||500===(null==(a=n.response)?void 0:a.status)){const t=(null==(r=null==(s=n.response)?void 0:s.data)?void 0:r.error)||"";t.includes("GHN_API_TOKEN")||t.includes("missing")||t.includes("not configured")}return[]}}async createPayment(t){try{return{data:(await c.post("/api/payments/create",t)).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to create payment"}}}async createVNPayPayment(t){try{const e=JSON.parse(localStorage.getItem("auth_user")||"{}"),a=e.id||e.userId||1;return{data:(await c.post("/api/payments/vnpay/create",{orderId:t,userId:a})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to create VNPay payment"}}}async processVNPayReturn(t){try{return{data:(await c.post("/api/payments/vnpay/return",t,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to process VNPay return"}}}async createMoMoPayment(t){try{const e=JSON.parse(localStorage.getItem("auth_user")||"{}"),a=e.id||e.userId||1;return{data:(await c.post("/api/payments/momo/create",{orderId:t,userId:a})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to create MoMo payment"}}}async confirmStripePayment(t){try{return{data:(await c.post("/api/payments/stripe/confirm",{paymentIntentId:t})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to confirm payment"}}}async validateCard(t){try{return{data:(await c.post("/api/payments/validate-card",t,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to validate card"}}}async getBankTransferStatus(t){try{return{data:(await c.get(`/api/payments/bank-transfer/status/${t}`)).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to get transfer status"}}}async getSupportedBanks(){try{return{data:(await c.get("/api/payments/banks",{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(t){return{data:void 0,success:!1,message:"Failed to get banks"}}}async logUserBehavior(t,e,a){try{return{data:(await c.post("/api/recommendations/behavior",{userId:t,productId:e,action:a})).data,success:!0}}catch(s){return{data:void 0,success:!1,message:"Failed to log user behavior"}}}async get(t){try{return{data:(await c.get(t)).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Request failed"}}}async post(t,e){try{return{data:(await c.post(t,e)).data,success:!0}}catch(a){return{data:void 0,success:!1,message:"Request failed"}}}async put(t,e){try{return{data:(await c.put(t,e)).data,success:!0}}catch(a){return{data:void 0,success:!1,message:"Request failed"}}}async delete(t){try{return{data:(await c.delete(t)).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Request failed"}}}isAuthenticated(){return!!(localStorage.getItem("auth_token")||localStorage.getItem("jwt"))}getAuthToken(){return localStorage.getItem("auth_token")||localStorage.getItem("jwt")}clearAuth(){localStorage.removeItem("auth_token"),localStorage.removeItem("jwt"),localStorage.removeItem("auth_user")}async getMLRecommendations(t,e=10){var a,s,r;try{return{data:(await c.get(`/api/recommendations/ml/user/${t}?limit=${e}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(n){return 401===(null==(a=n.response)?void 0:a.status)?{data:[],success:!1,message:"Recommendation service temporarily unavailable"}:{data:[],success:!1,message:(null==(r=null==(s=n.response)?void 0:s.data)?void 0:r.message)||"Failed to get ML recommendations"}}}async getMLStatus(){var t,e,a;try{return{data:(await c.get("/api/recommendations/ml/status",{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(s){return 401===(null==(t=s.response)?void 0:t.status)?{data:{modelLoaded:!1,modelInfo:"Service unavailable"},success:!1,message:"ML service temporarily unavailable"}:{data:{modelLoaded:!1,modelInfo:"Unknown"},success:!1,message:(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Failed to get ML status"}}}async getProductReviews(t,e=0,a=10,s="createdAt",r="desc"){try{return{data:(await c.get(`/api/reviews/product/${t}?page=${e}&size=${a}&sortBy=${s}&sortDir=${r}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(n){return{data:{content:[],totalElements:0},success:!1,message:"Failed to get product reviews"}}}async getReviewSummary(t){try{return{data:(await c.get(`/api/reviews/product/${t}/summary`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(e){return{data:{totalReviews:0,averageRating:0},success:!1,message:"Failed to get review summary"}}}async getRelatedProducts(t,e=4){try{return{data:(await c.get(`/api/products/${t}/related?limit=${e}`,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(a){return{data:[],success:!1,message:"Failed to get related products"}}}async getMyReviews(t,e=0,a=10){try{return{data:(await c.get(`/api/reviews/my-reviews?userId=${t}&page=${e}&size=${a}`)).data,success:!0}}catch(s){return{data:{content:[],totalElements:0},success:!1,message:"Failed to get my reviews"}}}async createReview(t){try{return{data:(await c.post("/api/reviews",t)).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to create review"}}}async updateReview(t,e){try{return{data:(await c.put(`/api/reviews/${t}`,e)).data,success:!0}}catch(a){return{data:void 0,success:!1,message:"Failed to update review"}}}async deleteReview(t,e){try{return{data:(await c.delete(`/api/reviews/${t}?userId=${e}`)).data,success:!0}}catch(a){return{data:void 0,success:!1,message:"Failed to delete review"}}}async markReviewHelpful(t){try{return{data:(await c.post(`/api/reviews/${t}/helpful`,{})).data,success:!0}}catch(e){return{data:void 0,success:!1,message:"Failed to mark review helpful"}}}async validateVoucher(t){var e,a,s;try{return{data:(await c.post("/api/vouchers/validate",t,{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(r){const t=(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"Failed to validate voucher";return{data:(null==(s=r.response)?void 0:s.data)||{valid:!1,message:t},success:!1,message:t}}}async getPublicVouchers(){var t,e;try{return{data:(await c.get("/api/vouchers/public",{headers:{"X-Skip-Auth":"true"}})).data,success:!0}}catch(a){return{data:[],success:!1,message:(null==(e=null==(t=a.response)?void 0:t.data)?void 0:e.message)||"Failed to get vouchers"}}}async createWarrantyRequest(t){try{return{data:(await c.post("/api/warranty/requests",t)).data,success:!0,message:"Warranty request created successfully"}}catch(e){return{data:void 0,success:!1,message:"Failed to create warranty request"}}}async getMyWarrantyRequests(t=0,e=10,a){try{const s=new URLSearchParams({page:t.toString(),size:e.toString()});a&&s.append("status",a);return{data:(await c.get(`/api/warranty/requests/my?${s}`)).data,success:!0,message:"Warranty requests retrieved successfully"}}catch(s){return{data:{content:[],totalElements:0,totalPages:0},success:!1,message:"Failed to get warranty requests"}}}async getWarrantyRequestById(t){try{return{data:(await c.get(`/api/warranty/requests/${t}`)).data,success:!0,message:"Warranty request retrieved successfully"}}catch(e){return{data:void 0,success:!1,message:"Failed to get warranty request"}}}async getWarrantyRequestByNumber(t){try{return{data:(await c.get(`/api/warranty/requests/number/${t}`)).data,success:!0,message:"Warranty request retrieved successfully"}}catch(e){return{data:void 0,success:!1,message:"Failed to get warranty request"}}}async sendSupportMessage(t){try{return{data:(await c.post("/api/support/contact",t)).data,success:!0,message:"Support message sent successfully"}}catch(e){return{data:void 0,success:!1,message:"Failed to send support message"}}}},i=!1;const o=new class{constructor(){e(this,"stompClient",null),e(this,"isConnected",!1),e(this,"reconnectAttempts",0),e(this,"maxReconnectAttempts",3),e(this,"reconnectDelay",1e4),e(this,"subscriptions",new Map),e(this,"currentUserId",null),e(this,"onPermissionChange",null),e(this,"onForceLogout",null),e(this,"onAdminNotification",null)}init(){try{const t=()=>new s("/ws");this.stompClient=r.over(t),this.stompClient.debug=()=>{},this.connect()}catch(t){this.scheduleReconnect()}}connect(t={}){if(this.stompClient)try{const e=localStorage.getItem("auth_token")||localStorage.getItem("token")||localStorage.getItem("jwt");e&&(t.Authorization=`Bearer ${e}`),t["heart-beat"]="10000,10000",this.stompClient.connect(t,t=>{this.isConnected=!0,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.currentUserId&&this.subscribeToUserTopics(this.currentUserId)},t=>{var e,a;this.isConnected=!1;const s=t;s&&(401===s.status||(null==(a=null==(e=s.headers)?void 0:e.message)?void 0:a.includes("401")))||this.scheduleReconnect()})}catch(e){this.isConnected=!1,this.scheduleReconnect()}}scheduleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>{this.connect()},this.reconnectDelay))}subscribeToUserTopics(t){var e;const a=this.stompClient.subscribe("/user/permission-change",t=>{try{const e=JSON.parse(t.body);i,this.onPermissionChange&&this.onPermissionChange(e)}catch(e){}}),s=this.stompClient.subscribe(`/user/${t}/permission-change`,t=>{try{const e=JSON.parse(t.body);i,this.onPermissionChange&&this.onPermissionChange(e)}catch(e){}}),r=this.stompClient.subscribe(`/user/${t}/force-logout`,t=>{try{const e=JSON.parse(t.body);i,this.onForceLogout&&this.onForceLogout(e)}catch(e){}}),c=this.stompClient.subscribe("/user/force-logout",t=>{try{const e=JSON.parse(t.body);i,this.onForceLogout&&this.onForceLogout(e)}catch(e){}});if("ADMIN"===(null==(e=this.getCurrentUser())?void 0:e.role)){const t=this.stompClient.subscribe("/topic/admin/permission-changes",t=>{try{const e=JSON.parse(t.body);i,this.onAdminNotification&&this.onAdminNotification(e)}catch(e){}});this.subscriptions.set("admin",t)}this.subscriptions.set("permission-change-id",s),this.subscriptions.set("permission-change-user",a),this.subscriptions.set("force-logout-id",r),this.subscriptions.set("force-logout-user",c)}getCurrentUser(){try{const t=localStorage.getItem("auth_user");if(t)return JSON.parse(t)}catch(t){}return null}connectUser(t){this.currentUserId=t,this.stompClient?this.isConnected&&(this.unsubscribeAll(),this.subscribeToUserTopics(t)):this.init()}disconnect(){this.unsubscribeAll(),this.stompClient&&(this.stompClient.disconnect(),this.stompClient=null),this.isConnected=!1,this.currentUserId=null}unsubscribeAll(){this.subscriptions.forEach(t=>{t&&t.unsubscribe()}),this.subscriptions.clear()}onPermissionChangeEvent(t){this.onPermissionChange=t}onForceLogoutEvent(t){this.onForceLogout=t}onAdminNotificationEvent(t){this.onAdminNotification=t}isWebSocketConnected(){return this.isConnected}getConnectionStatus(){return this.isConnected?"connected":this.reconnectAttempts>0?"reconnecting":"disconnected"}getCurrentUserInfo(){const t=this.getCurrentUser();return t?{id:t.id,username:t.username,role:t.role,connected:this.isConnected}:null}getConnectionDetails(){return{isConnected:this.isConnected,stompClient:!!this.stompClient,subscriptions:this.subscriptions.size,reconnectAttempts:this.reconnectAttempts,endpoint:"/ws"}}};window.addEventListener("beforeunload",()=>{o.disconnect()});const d=new class{constructor(){e(this,"loadingStates",new Map),e(this,"loadingCallbacks",new Map)}success(t,e){this.showToast(t,"success",null==e?void 0:e.duration)}error(t,e){this.showToast(t,"error",null==e?void 0:e.duration)}warning(t,e){this.showToast(t,"warning",null==e?void 0:e.duration)}info(t,e){this.showToast(t,"info",null==e?void 0:e.duration)}showToast(t,e,a=5e3){const s=document.createElement("div");s.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      padding: 12px 24px;\n      border-radius: 4px;\n      color: white;\n      font-family: Arial, sans-serif;\n      font-size: 14px;\n      z-index: 9999;\n      max-width: 400px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      animation: slideIn 0.3s ease-out;\n      word-wrap: break-word;\n    ";if(s.style.backgroundColor={success:"#4caf50",error:"#f44336",warning:"#ff9800",info:"#2196f3"}[e],s.textContent=t,document.body.appendChild(s),!document.getElementById("toast-styles")){const t=document.createElement("style");t.id="toast-styles",t.textContent="\n        @keyframes slideIn {\n          from { transform: translateX(100%); opacity: 0; }\n          to { transform: translateX(0); opacity: 1; }\n        }\n        @keyframes slideOut {\n          from { transform: translateX(0); opacity: 1; }\n          to { transform: translateX(100%); opacity: 0; }\n        }\n      ",document.head.appendChild(t)}setTimeout(()=>{s.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{document.body.contains(s)&&document.body.removeChild(s)},300)},a)}setLoading(t,e){this.loadingStates.set(t,e);(this.loadingCallbacks.get(t)||[]).forEach(t=>t())}isLoading(t){return this.loadingStates.get(t)||!1}onLoadingChange(t,e){var a;return this.loadingCallbacks.has(t)||this.loadingCallbacks.set(t,[]),null==(a=this.loadingCallbacks.get(t))||a.push(e),()=>{const a=this.loadingCallbacks.get(t)||[],s=a.indexOf(e);s>-1&&a.splice(s,1)}}async handleAsyncOperation(t,e,a,s){try{this.setLoading(e,!0);const s=await t();return a&&this.success(a),s}catch(r){const t="object"==typeof r&&r&&"message"in r?String(r.message):"An error occurred",e=s||t;return this.error(e),null}finally{this.setLoading(e,!1)}}};const u=new class{constructor(){e(this,"api",a.create({baseURL:"/api",headers:{"Content-Type":"application/json"}})),this.api.interceptors.request.use(t=>{const e=localStorage.getItem("auth_token")||localStorage.getItem("jwt");return e&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${e}`),t})}async getProducts(t={}){try{const e=new URLSearchParams;t.search&&e.append("search",t.search),t.category&&"all"!==t.category&&e.append("category",t.category),t.brand&&"all"!==t.brand&&e.append("brand",t.brand),void 0!==t.minPrice&&e.append("minPrice",t.minPrice.toString()),void 0!==t.maxPrice&&e.append("maxPrice",t.maxPrice.toString()),t.sortBy&&e.append("sortBy",t.sortBy),void 0!==t.page&&e.append("page",t.page.toString()),void 0!==t.size&&e.append("size",t.size.toString());return(await this.api.get(`/products?${e.toString()}`)).data}catch(e){throw e}}async getProductById(t){try{return(await this.api.get(`/products/${t}`)).data}catch(e){throw e}}async getFeaturedProducts(t=10){try{return(await this.api.get(`/products/featured?limit=${t}`)).data}catch(e){throw e}}async getProductsByCategory(t,e=0,a=12){try{return(await this.api.get(`/products/category/${t}?page=${e}&size=${a}`)).data}catch(s){throw s}}async getProductsByBrand(t,e=0,a=12){try{return(await this.api.get(`/products/brand/${t}?page=${e}&size=${a}`)).data}catch(s){throw s}}async searchProducts(t,e=0,a=12){try{return(await this.api.get(`/products/search?q=${encodeURIComponent(t)}&page=${e}&size=${a}`)).data}catch(s){throw s}}async getCategories(){try{return(await this.api.get("/categories")).data}catch(t){throw t}}async getBrands(){try{return(await this.api.get("/brands")).data}catch(t){throw t}}};export{n as a,d as n,u as p,o as w};
